## HTTP

### 键入网址后发生了什么

1. 解析url地址，获得发送的web信息
2. 解析出ip地址（dns）
3. 将传输任务交给操作系统的协议栈
4. 由TCP进行三次握手来建立连接
5. 在TCP各阶段操作时，IP模块需要将数据封装为网络包
6. 生成IP头部后，再在前面加入MAC头部
7. 通过网卡、交换机、路由器进行传输

### Http是什么

Http是一个在计算机世界用于在**两点**之间进行文字、图片、视频等超文本数据的传输所制定的协议和规范

### Http状态码有哪些

- 1xx：提示信息XX
- 2xx：成功信息，如200
- 3xx：代表重定向，如302表示临时重定向
- 4xx：代表客户端发送报文有误，如404表示资源未找到
- 5xx：代表服务端有问题，如503代表服务无法响应

### Http常见字段

- host：指定域名
- contention：是否长连接
- content-length：数据长度
- content-type：数据类型
- content-Encoding：数据压缩方式

### get和post区别

- get是对资源进行访问，是安全并且幂等的
- post是根据发送的报文请求对资源进行处理，是不安全不幂等的

### session和cookie的区别

session保存在服务端，cookie保存在客户端；session的唯一id一般也需要通过cookie传递

### Http缓存技术

主要有两种：强制缓存和协商缓存

- 强制缓存：通过服务端响应的过期时间来判断是否使用缓存
- 协商缓存：向服务端发送请求来判断是否使用缓存

### Http的优缺点

- 优点
  1. 简单，体现在报文上，头部信息是key-value结果，便于学习和使用
  2. 灵活易拓展，Http的请求方法，url，字段格式都没有严格的限制，开发人员可以根据自己的需求进行设计、
  3. 应用广泛，跨平台
- 缺点
  1. 无状态：服务器可以不记录，节省资源；但是不同的响应之间缺乏关联，每次都要重新对服务器进行询问（可以通过携带cookie的方式来解决这个问题）
  2. 明文：方便调试；但是信息是完全暴露的，有信息泄露的风险
  3. 不安全：
     1. 明文的问题导致的信息泄露
     2. 对通信方没有校验，例如用户可能会访问假的淘宝网站
     3. 无法验证明文的完整性，信息可能被篡改或者伪造

### Http和Https的区别？

1. Http是明文传输的，而Https是加密的
2. Http建立连接的过程相对简单，而Https在TCP层与Http层之间增加了SSL/TSL层，连接建立相对麻烦
3. Http的默认端口是80，Https的默认端口是443
4. Https需求申请数字证书从而保证服务是可信的

### Https的连接过程（TLS四次握手）

1. 第一次握手：客户端将自己支持的加密规则发送给服务端（对称算法、非对称算法、摘要算法）
2. 第二次握手：服务端选择出一套加密规则，将自身的信息以证书的形式发送给客户端，证书中包含地址信息，加密公钥，证书颁发机构信息
3. 第三次握手：客户端收到后，会对证书机构的公钥对证书签名进行验证，检查是否有效；检查无误后会生成一个对称加密钥匙，然后用服务器的公钥加密自己的私钥，并且使用Hash算法计算握手信息的摘要，用对称加密钥匙去加密摘要信息，发送给服务端
4. 第四次握手：服务端收到后用自己的私钥去解密获得用于对称加密的钥匙，同时解开摘要值并验证是否正确；然后同样计算握手信息的摘要，使用对称加密来加密摘要，发送给客户端，客户端检查无误后就建立连接，后续都使用对称加密来进行通信。

### Https解决了Http的哪些问题？

1. 信息泄露：使用了信息加密手段，加密后再传输
2. 信息篡改：使用了信息验证机制
3. 冒充服务：使用身份验证

### Http性能如何优化？

1. 使用缓存

2. 减少Http请求次数

   1. 让中间的代理服务器进行重定向从而减少Http请求
   2. 合并请求，把许多小的请求进行合并（例如将许多小的图片合并成大图片再发送）

   4. 延迟请求，不必一次性请求所有的资源

3. 数据压缩
   1. 无损压缩
   2. 有损压缩

### Httpt1.1的提升

1. 长连接：支持并默认使用长连接（1.0也可以长连接但不默认），即一次TCP连接建立后可以保持一段时间，从而反复连接和断开连接，性能有所提升
2. 管道传输：得益于长连接，管道传输也可行。即一次可以同时发送多个请求性能，有所提升
3. 支持带宽优化、断点续传
4. 队头堵塞：指一个请求发生堵塞时，后面的请求都会发生堵塞，从而导致性能一般
5. 新增PUT、DELETE等方法

### Http2.0相较于Http1.1的提升

1. 二进制分帧，所有帧用二进制进行编码，节省空间
2. 头部压缩，从而节约带宽资源
3. 多路复用：支持Stream并发，从而减少TCP，TLS的握手时间
4. 支持服务器主动发送资源

### Http3.0相较于Http2.0的提升

1. 在传输层使用了UDP协议，使得传输性能得到提升
2. 基于UDP协议在应用层使用QUIC协议，实现了类似TCP的可靠连接
   - QUIC协议的特点：
     1. 无队头堵塞，不同Stream流的传输不会互相影响
     2. 建立连接速度快，将TCP和TSL的握手进行了合并
     3. 连接迁移

## TCP

### OSI七层模型

- 应用层
- 会话层
- 表示层
- 传输层
- 网络层
- 数据链路层
- 物理层

### TCP/IP四层模型

- 应用层：软件应用
- 传输层：加上TCP头
- 网络层：加上IP头
- 网络接口层：封装为数据帧

### TCP的头格式

- 序列号——保证有序
- 确认应答号——保证不丢包
- 控制位

### TCP是什么

面向连接的、可靠的、基于字节流的传输层通讯协议

- 面向连接：一对一建立连接从而进行数据传输
- 可靠的：无论网络链路如何变化，保证将报文发送到接收端
- 字节流：TCP传输的数据是以流的形式，没有边界限制，并且要求有序

### 如何确定一个TCP连接

- 源端口
- 源地址
- 目标端口
- 目标地址

### TCP的UDP区别

- 连接：TCP是面向连接的；而UDP是不建立连接的
- 服务对象：TCP只支持一对一的两点服务；而UDP支持一对一，一对多，多对多
- 可靠性：TCP保证数据可靠；而UDP尽最大努力交付而不保证数据的可靠性
- 拥堵机制：TCP具有拥塞控制和流量控制两个机制；而UDP没有，即使在网络拥堵情况下也不影响速率
- 首部开销：TCP的首部开销相对较大；而UDP的首部开销是固定的8个字节，开销较小
- 传输方式：TCP是基于字节流进行传输的，数据没有边界，保证有序可靠；而UDP是能够发送包进行数据传输的，可能会丢包或者乱序
- 分片方式：TCP的数据大于最大报文段长度时，会在TCP层进行分组；而UDP的数据大于最大传输单元时，会在IP进行分组

### TCP和UDP的应用场景

- TCP：文件传输；Http、Https
- UDP：媒体传输，广播

### TCP三次握手

1. 第一次握手：客户端将生成一个随机初始序列号，设置SYN为1，发送给服务端，进入SYN_SEND状态
2. 第二次握手：服务端收到报文后，设置SYN为1，ACK为1，将客户端生成的初始序列号+1填入应答报文，并且自己生成一个随机初始序列号，发送给客户端，进入SYN_RCVD状态
3. 第三次握手：客户端收到报文后，检查应答报文是否正确，ACK为1，将服务端生成的序列号+1放入应答报文，发送给服务端。此时客户端进入建立连接的状态，服务端收到报文后检查无误也会进入建立连接的状态

### 为什么是三次握手

防止建立历史连接，避免资源浪费，并且同步初始化序列

- 为什么不是两次：可能发生历史连接，不可靠的同步初始化序列
- 为什么不是四次：理论上三次可以保证可靠连接，再多也是冗余

### 半连接队列和全连接队列

- 半连接队列（SYN队列）：服务端接收客户端的SYN报文后，创建一个半连接对象放入队列，发送ACK和SYN
- 全连接队列（accept队列）：服务端接收客户端的ACK报文后，从半连接队列中取出半连接对象，创建全连接对象放入队列，创建连接

### 握手失败会发生什么

- 第一次握手失败：客户端没收到应答超时重传
- 第二次握手失败：客户端没收到应答超时重传，服务端也没收到应答超时重传
- 第三次握手失败：服务端没收到应答超时重传

### 什么是SYN攻击

服务端每收到一个SYN就会创建一个半连接对象放入半连接队列，攻击者不断发送SYN报文，服务器的半连接队列就会被占满，导致无法再接受SYN报文

解决方法：

### TCP四次挥手

- 第一次挥手：客户端设置FIN为1，生成一个随机序列号，发送给服务端，进入FIN_WAIT_1状态
- 第二次挥手：服务端收到FIN报文后，设置ACK为1，将客户端生成的序列号+1填入应答报文，发送给客户端，进入CLOSED_WAIT状态；客户端收到ACK报文后检查无误就进入FIN_WAIT_2状态
- 第三次挥手：服务端设置FIN为1，生成一个随机序列号，发送给客户端，进入LAST_ACK状态
- 第四次挥手：客户端收到FIN报文后，设置ACK为1，将服务端生成的序列号+1填入应答报文，发送给服务端。客户端等待2MSL后进入CLOSED状态，服务端收到ACK报文检查无误后进入CLOSED状态

### 第二次和第三次为什么不合并

因为数据可能还没有处理完，当服务端收到客户端的连接断开请求时，先回复ACK确认收到了请求。等处理完数据再发送FIN报文，请求断开连接

### TIME-WAIT等待时间为什么是2MSL

- MSL指最大报文生存时间。2MSL相当与至少允许丢失一次报文，在TCP握手中，客户端发送ACK报文后就进入TIME-WAIT状态，如果ACK报文丢失，那么服务端在1MSL后会重发SYN报文，那么在2MSL时间内，客户端还是可以收到，从而保证连接正确的关闭。
- 为什么不舍4MSL或者更大？因为两次丢包的概率其实是非常小的，如果为了解决小概率问题而设置过长的等待时间，性价比不高

### 为什么需要TIME-WAIT状态

- 一是为了避免历史连接，在经过2MSL时间后关闭连接，此时再创建新的连接，那么可以保证收到数据不是历史连接的数据
- 二是可以保证连接可以被正确的关闭

### TIME-WAIT过多的危害

- 占用系统资源，比如文件描述符，内存资源，CPU资源，线程资源
- 占用端口资源（服务端不受影响）

### 什么情况TIME-WAIT会大量增加

- 没有使用长连接
- 长连接超时关闭
- 长连接数量达到最大值

### TCP重传机制

- 超时重传：超过一定时间没有收到应答则触发重传
- 快速重传：连续收到3次相同的应答报文则触发重传
- STACK重传：指在应答报文中告诉发送方哪些数据已经接收了，从而只需要选择缺少的数据进行重传
- D-STACK重传：指在应答报文中告诉发送方哪些数据被重复接收了，可以让发送方知道是数据丢了，还是ACK报文丢了

### 流量控制算法

发送方根据接收方接受数据的能力而调整发送速率的机制，具体实现：接受方维护一个窗口，每次回复ACK报文时都会传入可用窗口的大小，发送方根据接收方发来的信息进行调整（发送方的发送窗口不能大于接收方的接受窗口大小）。

### 什么是0窗口

接收方的可接受的窗口大小为0，此时发送方没停止发送数据，每隔一段时间发送探测报文来查看窗口状态。

### 拥塞控制算法

- 慢启动：连接刚启动时，拥塞窗口呈指数级增长
- 拥塞避免算法：拥塞窗口增长到门限后触发拥塞避免，拥塞窗口增长变为线性
- 拥塞发生：检测拥塞发生（连续三个相同ACK报文）时，进行快速恢复
- 快速恢复：
  - 一种是将窗口大小和慢启动门限变为窗口大小的二分之一，并触发拥塞避免
  - 一种是将窗口大小变为慢启动门限大小加3的窗口大小
- 超时重传：从头开始

### ping的工作原理

ping基于ICMP协议。执行命令后，源主机会构建一个ICMP回送请求消息数据包，这个数据包中有两个重要的字段，一个是类型，一个是序号。源主机发送数据包后如果在规定时间内没有收到回复，则认为目标主机不可达；如果收到就会计算延迟时间还有丢包率

### TCP如何保证可靠传输

1. 校验和
2. 序列号和确认应答，序列号保证数据有序，确认应答确保数据完整接收
3. 流量控制，TCP使用滑动窗口来调节数据发送的速率，从而避免缓冲区被占满
4. 拥塞控制，TCP有几种方式来进行拥塞控制，包括：慢启动，拥塞避免，拥塞发生以及快速恢复，从而避免网络拥塞
5. 重传机制：TCP中经常需要一端发送请求报文后，另一端发送应答报文，如果中间数据发生丢失，那么TCP的重传机制可以解决这个问题

## IP

### ip地址分类

- A类：0开头，8位网络号
- B类：1开头、16位网络号
- C类：11开头、24位网络号
- D类：111开头，多播地址
- E类：1111开头，备用

### 什么是划分子网

将主机号划分为子网网络络号和子网主机号，具体来说就是取出几个比特位来作为子网的网络。

### DNS解析过程

1. 先检查浏览器缓存、操作系统缓存、本地hosts文件
2. 向本地DNS服务器询问IP地址
3. 如果本地DNS服务器有该IP资源就直接返回
4. 本地DNS服务器向根DNS服务器询问，根DNS服务器返回负责该IP地址的顶级域DNS服务器地址
5. 本地DNS服务器向顶级域DNS服务器询问，顶级域DNS服务器返回负责该IP地址的权威DNS服务器
6. 本地DNS服务器向权威DNS服务器询问，获得IP地址
7. 本地DNS服务器返回IP地址给客户端，完成解析

### 路由控制

每个网络设备中会维护一张路由表，路由表记录着目标网络号和下一步要跳的网络号。当请求到达路由器，就会在路由表中匹配网络号，从而确定下一步要去的地址。如果有多个匹配，则选择相同位数最多的

### ARP

根据IP地址获取MAC地址，具体获取方式：主机会通过广播发送ARP请求，同个链路中的网络设备收到ARP请求后，会将其中的IP地址与自己进行比对，如果是自己的IP地址，则向主机回复自己MAC地址。操作系统会将ARP获得的MAC地址进行缓存

### RARP

根据MAC地址获取ip，用于注册设备

### DHCP

用于动态分配IP地址：

1. 客户端通过广播方式发送DHCP发现报文
2. DHCP服务端收到发现报文后，通过广播发送DHCP提供报文，包含可用的ID地址信息、默认网关、DNS服务器等等
3. 客户端收到DHCP的回复消息后，向选中的DHCP服务器发送DHCP请求报文，回显配置参数
4. DHCP收到请求报文后，应答所要求的报文，回复应答报文
5. 客户端收到应答报文后，就完成了IP地址分配

中继代理：DHCP可以选择中间路由器作为中继代理，当中继代理收到DHCP发现广播时，会用单播的方式转发给DHCP服务器，这样就使一个DHCP服务可以接受不同网络段的广播

### NAT

将内网的私有IP地址映射成公网IP从而公网中的服务器进行通信，具体来说：NAT路由器会将不同的私有地址映射到同一个公网IP下的不同的端口上，从而实现多个私有IP共用一个公有IP。

### ICMP

互联网控制报文协议，用于通知报文是否成功送达以及出现的故障问题信息

### IGMP

因特网组播管理协议。路由器记录会记录组播成员，主机通过IGMP来加入组或退出组。

### ping的工作原理

ping命令利用了ICMP协议的查询类型报文，执行ping命令时，源主机会构建一个回送请求消息包，包含序号和发送时间，然后发送给目标主机，目标主机收到会会构建一个回送响应，标识目标地址可达。如果在规定时间内源主机都没有收到回复，则认为目标主机不可达
